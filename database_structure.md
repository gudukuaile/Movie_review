# 电影评论系统数据库结构

本文档描述了电影介绍系统的数据库结构，包括各个表的字段和它们之间的关系。

## 数据库表结构

### 用户表 (users)

用户表存储系统中所有用户的信息。

| 字段名 | 类型 | 说明 | 约束 |
|-------|------|------|------|
| id | Integer | 用户ID | 主键 |
| username | String(80) | 用户名 | 非空，唯一 |
| email | String(120) | 邮箱 | 非空，唯一 |
| password_hash | String(128) | 密码哈希值 | - |
| avatar | String(255) | 头像URL | - |
| phone | String(20) | 电话号码 | - |
| bio | Text | 个人简介 | - |
| created_at | DateTime | 注册时间 | 默认为当前时间 |
| role_id | Integer | 角色ID | 外键，关联roles表 |

### 角色表 (roles)

角色表定义了系统中不同类型的用户角色及其权限。

| 字段名 | 类型 | 说明 | 约束 |
|-------|------|------|------|
| id | Integer | 角色ID | 主键 |
| name | String(64) | 角色名称 | 唯一 |
| default | Boolean | 是否为默认角色 | 索引 |
| permissions | Integer | 权限值 | - |

### 电影表 (movies)

电影表存储电影的基本信息。

| 字段名 | 类型 | 说明 | 约束 |
|-------|------|------|------|
| id | Integer | 电影ID | 主键 |
| link | String(255) | 电影详情链接 | - |
| img_src | String(255) | 图片链接 | - |
| title | String(100) | 影片中文名 | - |
| rating | Float | 评分 | - |
| judge_num | Integer | 评价人数 | - |
| quote | Text | 简介 | - |
| director | String(100) | 导演 | - |
| actors | String(200) | 主演 | - |
| year | String(10) | 年份 | - |
| country | String(50) | 国家 | - |
| duration | String(20) | 片长 | - |
| created_at | DateTime | 创建时间 | 默认为当前时间 |

### 电影类型表 (genres)

电影类型表存储所有可用的电影类型。

| 字段名 | 类型 | 说明 | 约束 |
|-------|------|------|------|
| id | Integer | 类型ID | 主键 |
| name | String(50) | 类型名称 | 非空，唯一 |

### 电影-类型关联表 (movie_genres)

电影-类型关联表是多对多关系的中间表，用于关联电影和类型。

| 字段名 | 类型 | 说明 | 约束 |
|-------|------|------|------|
| id | Integer | 关联ID | 主键 |
| movie_id | Integer | 电影ID | 外键，关联movies表，非空 |
| genre_id | Integer | 类型ID | 外键，关联genres表，非空 |

### 评论表 (reviews)

评论表存储用户对电影的评论和评分。

| 字段名 | 类型 | 说明 | 约束 |
|-------|------|------|------|
| id | Integer | 评论ID | 主键 |
| content | Text | 评论内容 | 非空 |
| rating | Integer | 评分 | - |
| created_at | DateTime | 创建时间 | 默认为当前时间 |
| user_id | Integer | 用户ID | 外键，关联users表，非空 |
| movie_id | Integer | 电影ID | 外键，关联movies表，非空 |

## 权限系统

系统使用位运算来管理权限，定义了以下权限：

| 权限名 | 值 | 说明 |
|-------|-----|------|
| COMMENT | 1 | 评论电影权限 |
| MOVIE_EDIT | 2 | 编辑电影权限 |
| MOVIE_DELETE | 4 | 删除电影权限 |
| ADMIN | 8 | 管理员权限 |

系统预定义了三种角色：

1. **User**：普通用户，只有评论权限
2. **Editor**：编辑，具有评论和编辑电影的权限
3. **Admin**：管理员，拥有所有权限

## 数据库关系图

```
+-------+       +--------+       +---------+
| roles |<------| users  |------>| reviews |
+-------+       +--------+       +---------+
                    |                 |
                    |                 |
                    v                 |
                +--------+            |
                | movies |<-----------+
                +--------+
                    ^
                    |
                    |
+-------+       +-----------+
|genres |<----->|movie_genres|
+-------+       +-----------+
```

## 关系说明

1. **用户-角色**：一对多关系，一个角色可以分配给多个用户，一个用户只能有一个角色。
2. **用户-评论**：一对多关系，一个用户可以发表多条评论，一条评论只能由一个用户发表。
3. **电影-评论**：一对多关系，一部电影可以有多条评论，一条评论只能属于一部电影。
4. **电影-类型**：多对多关系，通过movie_genres中间表实现，一部电影可以有多个类型，一个类型可以对应多部电影。

## 权限控制流程

1. 用户注册时，默认分配为"User"角色，只有评论权限。
2. 管理员可以在后台修改用户角色，赋予更高的权限。
3. 系统在用户执行操作时，会检查用户的角色是否具有相应的权限。
4. 只有具有相应权限的用户才能执行特定操作，如编辑或删除电影。

## 管理功能

### 用户管理
- 查看所有用户信息
- 编辑用户角色
- 重置用户密码

### 电影管理
- 添加新电影
- 编辑电影信息
- 删除电影
- 管理电影类型

### 评论管理
- 查看所有评论
- 编辑评论内容和评分
- 删除不适当的评论 