{% extends "base.html" %}

{% block content %}
<div class="row">
    <div class="col-md-4">
        {% if movie.img_src and movie.img_src.startswith('http') %}
            <img src="{{ movie.img_src }}" class="img-fluid rounded" alt="{{ movie.title }}">
        {% elif movie.img_src %}
            <img src="{{ url_for('static', filename=movie.img_src) }}" class="img-fluid rounded" alt="{{ movie.title }}">
        {% else %}
            <div class="d-flex justify-content-center align-items-center bg-light rounded" style="height: 300px;">
                <span class="text-muted">暂无图片</span>
            </div>
        {% endif %}
    </div>
    <div class="col-md-8">
        <h1>{{ movie.title }}</h1>
        <p class="text-muted">{{ movie.year }} | {{ movie.genre }}</p>
        <h5>导演：{{ movie.director }}</h5>
        <h5>主演：{{ movie.actors }}</h5>
        <h5>国家：{{ movie.country }}</h5>
        <h5>片长：{{ movie.duration }}</h5>
        <div class="mt-4">
            <h4>简介</h4>
            <p>{{ movie.quote }}</p>
        </div>
        <div class="mt-4">
            <h4>评分信息</h4>
            <p>评分：{{ movie.rating }}，评价人数：{{ movie.judge_num }}</p>
        </div>
    </div>
</div>

<div class="mt-5">
    <h3>用户评价</h3>
    {% if current_user.is_authenticated %}
    <form method="POST" action="{{ url_for('movie.add_review', id=movie.id) }}" class="mb-4">
        <div class="mb-3">
            <label for="rating" class="form-label">评分</label>
            <select class="form-select" id="rating" name="rating" required>
                <option value="1">1星</option>
                <option value="2">2星</option>
                <option value="3">3星</option>
                <option value="4">4星</option>
                <option value="5">5星</option>
            </select>
        </div>
        <div class="mb-3">
            <label for="content" class="form-label">评价内容</label>
            <textarea class="form-control" id="content" name="content" rows="3" required></textarea>
        </div>
        <button type="submit" class="btn btn-primary">提交评价</button>
    </form>
    {% endif %}

    <div class="reviews">
        {% for review in movie.reviews %}
        <div class="card mb-3">
            <div class="card-body">
                <h5 class="card-title">{{ review.author.username }}</h5>
                <h6 class="card-subtitle mb-2 text-muted">评分：{{ review.rating }}星</h6>
                <p class="card-text">{{ review.content }}</p>
                <small class="text-muted">{{ review.created_at.strftime('%Y-%m-%d %H:%M') }}</small>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}